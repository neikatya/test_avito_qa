# BUGS: Найденные дефекты в Ads Microservice API

**Base URL:** `https://qa-internship.avito.com`

**Окружение:** QA internship stand

**Формат данных:** JSON

**Версии API:** v1, v2

---

## High severity / High priority

### BUG-1 POST /api/1/item позволяет создать объявление с отрицательной ценой

**Описание:**
Сервис позволяет создать объявление с отрицательным значением поля `price`, что противоречит бизнес-логике.

**Фактическое поведение:**

* HTTP: 200 OK
* Объявление создаётся с `price < 0`.

**Ожидаемое поведение:**

* HTTP: 400 Bad Request
* Ошибка валидации поля `price`.

**Severity:** High

**Priority:** High

---

## Medium severity / Medium priority

### BUG-2 Некорректная валидация поля statistics.likes (0 считается ошибкой)

**Описание:**
Значение `statistics.likes = 0` приводит к `400 Bad Request`, хотя `0` является валидным начальным значением счётчика.

**Шаги воспроизведения:**

```json
{
  "sellerID": 111666,
  "name": "Test item",
  "price": 1000,
  "statistics": {
    "likes": 0,
    "viewCount": 1,
    "contacts": 35
  }
}
```

**Фактическое поведение:**

* HTTP: 400 Bad Request

```json
{
  "result": {
    "message": "none likes обязательно",
    "messages": {}
  },
  "status": "400"
}
```

**Ожидаемое поведение:**

* HTTP: 200 OK
* Объявление успешно создаётся.

**Обоснование:**
Вероятно используется проверка `if not likes` вместо проверки на `null`.

**Severity:** Medium

**Priority:** Medium

---

### BUG-3 POST /api/1/item возвращает неполный ответ (только status с id)

**Описание:**
Метод создания объявления возвращает только строковое поле `status` с id объявления, без данных созданного ресурса.

**Фактическое поведение:**

```json
{
  "status": "Сохранили объявление - <uuid>"
}
```

**Ожидаемое поведение:**

* Возврат объекта созданного объявления
  или минимум `{ "id": "<uuid>" }`.

**Почему это проблема:**

* Требуется дополнительный GET-запрос.
* Усложняется автотестирование и клиентская логика.

**Severity:** Medium

**Priority:** Medium

---

### BUG-4 Неконсистентность HTTP-статуса и тела ошибки при повторном удалении объявления

**Описание:**
При повторном удалении уже удалённого объявления HTTP-код и тело ответа противоречат друг другу.

**Фактическое поведение:**

* HTTP: 404

```json
{
  "result": {
    "message": "",
    "messages": null
  },
  "status": "500"
}
```

**Ожидаемое поведение:**

* HTTP и тело ошибки согласованы (например, 404 + `"status": "404"`).

**Severity:** Medium

**Priority:** Medium

---

### BUG-5 POST /api/1/item принимает отрицательные значения statistics

**Описание:**
Сервис принимает отрицательные значения `likes`, `viewCount`, `contacts`.

**Фактическое поведение:**

* HTTP: 200 OK
* Отрицательные значения сохраняются.

**Ожидаемое поведение:**

* HTTP: 400 Bad Request
* Ошибка валидации статистики.

**Severity:** Medium

**Priority:** Medium

---

### BUG-6 GET /api/1/statistic/{id} возвращает статистику после удаления объявления

**Описание:**
После удаления объявления через `DELETE /api/2/item/{id}` его статистика остается доступной через `GET /api/1/statistic/{id}`.

**Шаги воспроизведения:**

1. Создать объявление через `POST /api/1/item`
2. Удалить объявление через `DELETE /api/2/item/{id}`
3. Запросить статистику через `GET /api/1/statistic/{id}`

**Фактическое поведение:**

* HTTP: 200 OK
* Статистика удаленного объявления возвращается

**Ожидаемое поведение:**

* HTTP: 404 Not Found
* Статистика должна удаляться вместе с объявлением

**Severity:** Medium

**Priority:** High (нарушена консистентность данных)

---

## Low severity / Low priority

### BUG-7 Неконсистентный формат ответа GET /api/1/item/{id}

**Описание:**
Метод получения объявления по id возвращает массив, хотя ожидается один объект.

**Фактическое поведение:**

```json
[
  { "id": "...", "sellerId": 111666, ... }
]
```

**Ожидаемое поведение:**

```json
{ "id": "...", "sellerId": 111666, ... }
```

или явное описание массива в контракте API.

**Severity:** Low

**Priority:** Low

---

### BUG-8 Отсутствие валидации диапазона sellerID

**Описание:**
POST /api/1/item принимает `sellerID` вне рекомендуемого диапазона 111111–999999.

**Комментарий:**
Может быть допустимым поведением — требует уточнения требований.

**Severity:** Low

**Priority:** Low

---

### BUG-9 GET /api/1/{sellerID}/item не различает “продавец не найден” и “нет объявлений”

**Описание:**
Для несуществующего `sellerID` возвращается `200 OK` и пустой массив без пояснений.

**Severity:** Low

**Priority:** Low

---

### BUG-10 Несогласованный формат ошибок между эндпоинтами

**Описание:**
Разные эндпоинты возвращают ошибки в разном формате (`status`, `result`, `messages`).

**Ожидаемое поведение:**

* Единый контракт ошибок для всего API.

**Severity:** Low

**Priority:** Low
